<htmL>
    <head>
        <!--<script src="../Classes/Graphics/2d/.Compiled.js"></script>-->
        
        <!--libraries-->
        <script src="../../Libraries/jQuery.js"></script>
        <script src="../../Libraries/pixi.min.js"></script>
        <script src="../../Libraries/pixiLayers.js"></script>
        <script src="../../Libraries/stats.js"></script>
        <script src="../../Libraries/RBush-3d.js"></script>
        
        <!--resize system-->
        <script src="../../Classes/GUI/resize.js"></script>
        
        <!--Alex's tree system-->
        <script src="../../Classes/Tree/Tree.js"></script>
        <script src="../../Classes/Tree/TreeNode.js"></script>
        
        <!--graphics interface-->
        <script src="../../Classes/Graphics/Utils/XYZ.js"></script>
        <script src="../../Classes/Graphics/Utils/Vec.js"></script>
        <script src="../../Classes/Graphics/Options.js"></script>
        
        <script src="../../Classes/Graphics/AbstractCamera.js"></script>
        <script src="../../Classes/Graphics/AbstractGraphics.js"></script>
        <script src="../../Classes/Graphics/AbstractShape.js"></script>
        <script src="../../Classes/Graphics/AbstractVisualisation.js"></script>
        
        <!--2d graphics api-->
        <script src="../../Classes/Graphics/2d/Camera.js"></script>
        <script src="../../Classes/Graphics/2d/Graphics.js"></script>
        <script src="../../Classes/Graphics/2d/Shape.js"></script>
        <script src="../../Classes/Graphics/2d/Shapes/Circle.js"></script>
        <script src="../../Classes/Graphics/2d/Shapes/CompoundShape.js"></script>
        <script src="../../Classes/Graphics/2d/Shapes/ShapeGroup.js"></script>
        <script src="../../Classes/Graphics/2d/Shapes/NodeShape.js"></script>
        <script src="../../Classes/Graphics/2d/IO2d.js"></script>
        <script src="../../Classes/Graphics/2d/Visualisation.js"></script>
    </head>
    <body>
        <div class=container>
            <div class=q1>
                
            </div>
            <div class=q2>
            </div>
        </div>
    </body>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            margin: 0px;
        }
        .container{
            width: 100%;
            height: 100%;
            vertical-align: top;
        }
        .pixi{
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .resizeHandleInnerDisplay{
            background-color: white !important;
        }
        .q1,.q2{
            background-color: black;
            position: relative;
        }
    </style>
    <script>
        this.debug = true;
        
        //call the initialisation  code for my system
        $(".container").resizeContainer({vertical:false});
        
        //the visualisation class
        class Visualisation extends Visualisation2d{
            constructor(container, tree, options){
                super(container, tree, options);
            }
            __getNodeShapeClass(VIZ){
                var camera = this.getCamera();
                var gfx = this;
                var initWidth = 400;
                return class NodeShape extends VIZ.NodeShape{
                    constructor(gfx, node, scale){
                        super(gfx, node, {scale:scale||1});
                        
                        //create primary circle shape
                        this.circle = new VIZ.Circle(gfx, 30*this.scale, 0xff0000);
                        this.addShape(this.circle);
                        
                        this.setAngle(Math.random());
                        
                        //create return button cicle shape
                        this.ret = new VIZ.Circle(gfx, 10*this.scale, 0x00ff00);
                        this.ret.setLoc(-20*this.scale, 0);
                        this.addShape(this.ret);
                        var This = this;
                        this.ret.onClick(function(){ //select parent when this is clicked
                            This.createParent();
                            var p = This.getParent();
                            if(p) p.focus();
                            return true;
                        });
                        
                        this.onUpdate(function(){
                            this.getLoc().add((Math.random()-0.5)*this.scale, (Math.random()-0.5)*this.scale);
                        });
                        this.onClick(function(){
                            this.focus();
                        });
                    }
                    __stateChanged(field, val, oldState){
                        if(field=="focused" && val==true){
                            camera.setTarget(this, this, 1/this.scale);
                        
                            this.createDescendants(2);      //creates 2 layers of descendants
                            this.destroyDescendants(2);     //destroys any descendants above those 2 layers
                            
                            this.createAncestors(2);        //creates 2 layers of ancestors
                            this.destroyAncestors(2, true); //destroys any ancestors below those 2 layers
                        }
                        
                        this.circle.setColor(this.state.expanded?0x0000ff:0xff0000);
                    }
                    __parentConnectionChange(first){
                        var parent = this.getParent();
                        if(parent && first){
                            var w = (-parent.scale/2 + (this.getIndex()+0.5)*this.scale)*initWidth;
                            this.setLoc(new VIZ.Vec(parent.getLoc()).add(w, -130*parent.scale, 0));
                        }
                    }
                    
                    __createNodeShape(node){
                        var scale = this.scale/this.__getChildNodes().length;
                        return new (this.__getClass())(this.getGraphics(), node, scale);
                    }
                }
            }
        }
        
        //visualisation setup
        var createTree = function(name, height){
            var children = [];
            if(height>0){
                var childCount = Math.floor(Math.random()*3)+1;
                for(var i=0; i<childCount; i++){
                    children.push(createTree(name+"-"+i, height-1));
                }
            }
            return {
                name: name,
                children: children
            };
        }
        var tree = new Tree(createTree("Stuff", 10));
        var options = new Options();
        var visualisation = new Visualisation($(".q1"), tree, options);
        
        var visualisation = new Visualisation($(".q2"), tree, options);
    </script>
</html>