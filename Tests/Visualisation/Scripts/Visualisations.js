(function(){var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}(function(){var NodeShape=function(_VIZ2D$NodeShape){_inherits(NodeShape,_VIZ2D$NodeShape);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);if(!scale)scale=1;var _this=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale}));_this.setScale(_this.scale);_this.circle=new VIZ2D.Circle(gfx,30,16711680);_this.addShape(_this.circle);_this.onClick(function(data){this.focus()});return _this}_createClass(NodeShape,[{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale/parent.getNode().getChildren().length;return new(this.__getClass())(this.getGraphics(),node,scale)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var spaceWidth=600;var nodeCount=parent.getNode().getChildren().length;var widthPerChild=spaceWidth/nodeCount;var x=-spaceWidth/2;x+=this.getIndex()*widthPerChild;x+=widthPerChild*0.5;x*=parent.scale;this.setLoc(parent.getX()+x,parent.getY()-200*this.scale)}}},{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTarget(this,this,this);this.showFamily(2,3)}}}]);return NodeShape}(VIZ2D.NodeShape);var Example=function(_VIZ2D$Visualisation){_inherits(Example,_VIZ2D$Visualisation);function Example(container,tree,options){_classCallCheck(this,Example);return _possibleConstructorReturn(this,(Example.__proto__||Object.getPrototypeOf(Example)).call(this,container,tree,options))}_createClass(Example,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(){return NodeShape}},{key:"__setupOptions",value:function __setupOptions(options){var This=this;options.add(new Options.Button("center").onClick(function(){This.synchronizeNode("focused",This.getTree().getRoot())}))}}]);return Example}(VIZ2D.Visualisation);Example.description={name:"example",description:"Some example visualisation",image:""};VisualisationHandler.registerVisualisation(Example)})();(function(){var NodeShape=function(_VIZ3D$NodeShape){_inherits(NodeShape,_VIZ3D$NodeShape);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);if(!scale)scale=1;var _this3=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale}));_this3.setScale(_this3.scale);_this3.sphere=new VIZ3D.Sphere(gfx,0.07,16711680);_this3.addShape(_this3.sphere);_this3.onClick(function(data){this.focus()});return _this3}_createClass(NodeShape,[{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale/parent.getNode().getChildren().length;return new(this.__getClass())(this.getGraphics(),node,scale)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var spaceWidth=1;var nodeCount=parent.getNode().getChildren().length;var widthPerChild=spaceWidth/nodeCount;var x=-spaceWidth/2;x+=this.getIndex()*widthPerChild;x+=widthPerChild*0.5;x*=parent.scale;this.setLoc(parent.getX()+x,parent.getY()-0.2*(parent.scale+this.scale)/2)}}},{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTargetLoc(this).setTargetScale(this);this.showFamily(2,3)}if(this.sphere)this.sphere.setColor(this.state.expanded?255:16711680)}}]);return NodeShape}(VIZ3D.NodeShape);var Example3d=function(_VIZ3D$Visualisation){_inherits(Example3d,_VIZ3D$Visualisation);function Example3d(container,tree,options){_classCallCheck(this,Example3d);var _this4=_possibleConstructorReturn(this,(Example3d.__proto__||Object.getPrototypeOf(Example3d)).call(this,container,tree,options));var camera=_this4.getCamera();_this4.onUpdate(function(){camera.getRot().add(0,options.getValue("rotation")/30,0)});var light=new VIZ3D.PointLight(_this4,16777215).setLoc(0.1,0.4,0).add();return _this4}_createClass(Example3d,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(){return NodeShape}},{key:"__setupOptions",value:function __setupOptions(options){var This=this;options.add(new Options.Button("center").onClick(function(){This.synchronizeNode("focused",This.getTree().getRoot())}));options.add(new Options.Number("rotation",0.5))}}]);return Example3d}(VIZ3D.Visualisation);Example3d.description={name:"example3d",description:"Some 3d example visualisation",image:""};VisualisationHandler.registerVisualisation(Example3d)})();(function(){function HSVtoInt(h,s,v){var r,g,b,i,f,p,q,t;if(arguments.length===1){s=h.s,v=h.v,h=h.h}i=Math.floor(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break;}return(Math.round(r*255)<<16)+(Math.round(g*255)<<8)+Math.round(b*255)}var initWidth=30;var NodeShape=function(_VIZ2D$NodeShape2){_inherits(NodeShape,_VIZ2D$NodeShape2);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);var _this5=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale||1;this.angle=0.5}));_this5.setScale(_this5.scale);_this5.color=HSVtoInt(_this5.getDepth()/6,1,1);_this5.circle=new VIZ2D.Circle(gfx,30,_this5.color);_this5.addShape(_this5.circle);_this5.text=new VIZ2D.HtmlShape(gfx,"<p style=\"background-color:orange\">"+node.getName()+"</p>",0);_this5.text.setScale(2);_this5.onHover(function(enter){if(enter)this.addShape(this.text);else{this.removeShape(this.text)}});return _this5}_createClass(NodeShape,[{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTarget(this,this,this);this.createDescendants(2);this.destroyDescendants(2);this.createAncestors(2);this.destroyAncestors(2,true)}}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var offset=0;for(var i=0;i<this.getIndex();i++){offset=offset+parent.getChildren()[i].scale}this.angle=0;this.angle=(offset+0.5*this.scale)/parent.scale;this.setAngle((this.angle*2+0.5)*Math.PI);var w=initWidth*(parent.scale*0.9-this.scale);this.setLoc(new VIZ2D.Vec(parent.getLoc()).add(w*Math.cos(this.angle*2*Math.PI),w*Math.sin(this.angle*2*Math.PI),0))}}},{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale*0.9/parent.getNode().getChildren().length;return new(this.__getClass())(this.getGraphics(),node,scale)}}]);return NodeShape}(VIZ2D.NodeShape);var Froth=function(_VIZ2D$Visualisation2){_inherits(Froth,_VIZ2D$Visualisation2);function Froth(container,tree,options){_classCallCheck(this,Froth);var _this6=_possibleConstructorReturn(this,(Froth.__proto__||Object.getPrototypeOf(Froth)).call(this,container,tree,options));_this6.renderdepth=2;_this6.mouseloc=null;_this6.onMouseScroll(function(amount,event){var camera=this.getCamera();var oldScale=camera.getScale();var newScale=Math.max(this.camera.getScale()*Math.pow(1.1,amount/100),1);this.camera.setScale(newScale);var offset=new VIZ2D.Vec(this.getMouseLoc()).sub(camera.getLoc());camera.getLoc().add(new VIZ2D.Vec(offset).mul(newScale/oldScale).sub(offset));this.updateScreen();this.renderdepth=1/this.camera.getScale()});_this6.onMouseMove(function(loc,event){if(this.pressed){if(this.mouseloc){var delta=this.camera.translateScreenToWorldLoc(loc).sub(this.mouseloc);this.camera.setLoc(this.camera.getLoc().add(new VIZ2D.Vec(delta).mul(-1)));;}}this.mouseloc=this.camera.translateScreenToWorldLoc(loc)});_this6.onMousePress(function(down,event){if(down){this.pressed=true}else{this.pressed=false;this.updateScreen()}});_this6.updateScreen();return _this6}_createClass(Froth,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(VIZ){return NodeShape}},{key:"updateScreen",value:function updateScreen(){this.shapes.root[0].destroyDescendants(1);this.loadShape(this.shapes.root[0])}},{key:"loadShape",value:function loadShape(shape){if(shape.getScale()>this.renderdepth&&shape.isVisible()){shape.createDescendants(1);for(var i=0;i<shape.getChildren().length;i++){this.loadShape(shape.getChildren()[i])}}}}]);return Froth}(VIZ2D.Visualisation);Froth.description={name:"froth",description:"",image:""};VisualisationHandler.registerVisualisation(Froth)})();(function(){var initWidth=100;var NodeShape=function(_VIZ2D$NodeShape3){_inherits(NodeShape,_VIZ2D$NodeShape3);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);var _this7=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale||1;this.angle=0.75}));_this7.setScale(_this7.scale);_this7.lit=new VIZ2D.Circle(gfx,36,16776960);_this7.circle=new VIZ2D.Circle(gfx,30,16711680);_this7.addShape(_this7.circle);_this7.label=new VIZ2D.Circle(gfx,10,1895760127);_this7.label.setLoc(20,20,0);_this7.text=new VIZ2D.HtmlShape(gfx,"<p style=\"background-color:orange\">"+node.getName()+"</p>",0);_this7.text.setScale(2);_this7.setZ(-_this7.getNode().getDepth());_this7.onHover(function(enter){if(enter)this.addShape(this.text);else{this.removeShape(this.text)}});_this7.ret=new VIZ2D.Circle(gfx,10,65280);_this7.ret.setLoc(-20,0);_this7.addShape(_this7.ret);var This=_this7;_this7.ret.onClick(function(){This.createParent();var p=This.getParent();if(p){this.getGraphics().setFocussed(p);this.getGraphics().highlight(This)}return true});_this7.onClick(function(){this.getGraphics().setFocussed(this);this.getGraphics().highlight(this.children[0])});_this7.__stateChanged("expanded");return _this7}_createClass(NodeShape,[{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTarget(this,this,this);this.createDescendants(3);this.destroyDescendants(3);this.createAncestors(2);this.destroyAncestors(2,true)}if(field=="expanded")this.circle.setColor(this.state.expanded?255:16711680)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var offset=0;for(var i=0;i<this.getIndex();i++){offset=offset+parent.getChildren()[i].scale}this.angle=0;this.angle=parent.angle-0.3+0.6*((offset+0.5*this.scale)/parent.scale);this.setAngle((this.angle*2+0.5)*Math.PI);var w=initWidth*parent.scale;this.setLoc(new VIZ2D.Vec(parent.getLoc()).add(w*Math.cos(this.angle*2*Math.PI),w*Math.sin(this.angle*2*Math.PI),0));var v=new VIZ2D.Vec(parent.getLoc()).sub(this.getLoc());v.setAngle(0);v.setLength(30*parent.scale/this.scale);var k=new VIZ2D.Vec(parent.getLoc()).sub(this.getLoc()).mul(1/this.scale).setAngle(0.5*Math.PI).add(v);var l=new VIZ2D.Vec(parent.getLoc()).sub(this.getLoc()).mul(1/this.scale).setAngle(0.5*Math.PI).sub(v);this.connection=new VIZ2D.Polygon(this.getGraphics(),[0,0,k.x,k.y,l.x,l.y],7798784);this.connection.setZ(-150);this.addShape(this.connection)}}},{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale*node.getSubtreeNodeCount()/node.getParent().getSubtreeNodeCount();return new(this.__getClass())(this.getGraphics(),node,scale)}},{key:"highlight",value:function highlight(){this.addShape(this.lit);this.lit.setZ(-100);this.addShape(this.text)}},{key:"unhighlight",value:function unhighlight(){this.removeShape(this.lit);this.removeShape(this.text)}}]);return NodeShape}(VIZ2D.NodeShape);var Jesterhat=function(_VIZ2D$Visualisation3){_inherits(Jesterhat,_VIZ2D$Visualisation3);function Jesterhat(container,tree,options){_classCallCheck(this,Jesterhat);var _this8=_possibleConstructorReturn(this,(Jesterhat.__proto__||Object.getPrototypeOf(Jesterhat)).call(this,container,tree,options));_this8.focussed=_this8.getShapesRoot()[0];_this8.highlighted=_this8.getShapesRoot()[0];_this8.onKeyPress(function(down,key,event){if(down){console.log(key);if(key=="arrowleft"){if(this.highlighted.getParent()){var i=this.highlighted.getNode().getParent().getChildren().indexOf(this.highlighted.getNode())-1;if(i<0)i=i+this.highlighted.getNode().getParent().getChildren().length;this.highlight(this.highlighted.getNode().getParent().getChildren()[i].getShape(this.getUID()))}}else if(key=="arrowright"){if(this.highlighted.getParent()){var i=this.highlighted.getNode().getParent().getChildren().indexOf(this.highlighted.getNode())+1;if(i>=this.highlighted.getNode().getParent().getChildren().length)i=0;this.highlight(this.highlighted.getNode().getParent().getChildren()[i].getShape(this.getUID()))}}else if(key=="arrowup"){this.setFocussed(this.highlighted);if(this.focussed.getChildren().length>0)this.highlight(this.focussed.getChildren()[0])}else if(key=="arrowdown"){this.highlight(this.focussed);if(this.focussed.getParent())this.setFocussed(this.focussed.getParent())}}});return _this8}_createClass(Jesterhat,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(VIZ){return NodeShape}},{key:"setFocussed",value:function setFocussed(a){this.focussed=a;a.focus()}},{key:"highlight",value:function highlight(b){this.highlighted.unhighlight();this.highlighted=b;this.highlighted.highlight()}}]);return Jesterhat}(VIZ2D.Visualisation);Jesterhat.description={name:"Jesterhat",description:"",image:""};VisualisationHandler.registerVisualisation(Jesterhat)})();(function(){var NodeShape=function(_VIZ2D$NodeShape4){_inherits(NodeShape,_VIZ2D$NodeShape4);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);if(!scale)scale=1;var _this9=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale}));_this9.setScale(_this9.scale);_this9.circle=new VIZ2D.RadialBand(gfx,50,16711680);_this9.addShape(_this9.circle);_this9.onClick(function(data){this.focus()});return _this9}_createClass(NodeShape,[{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale/parent.getNode().getChildren().length;return new(this.__getClass())(this.getGraphics(),node,scale)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var spaceWidth=600;var nodeCount=parent.getNode().getChildren().length;var widthPerChild=spaceWidth/nodeCount;var x=-spaceWidth/2;x+=this.getIndex()*widthPerChild;x+=widthPerChild*0.5;x*=parent.scale;this.setLoc(parent.getX()+x,parent.getY()-200*this.scale)}}},{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTarget(this,this,this);this.showFamily(2,3)}}}]);return NodeShape}(VIZ2D.NodeShape);var Mehrdadtest=function(_VIZ2D$Visualisation4){_inherits(Mehrdadtest,_VIZ2D$Visualisation4);function Mehrdadtest(container,tree,options){_classCallCheck(this,Mehrdadtest);return _possibleConstructorReturn(this,(Mehrdadtest.__proto__||Object.getPrototypeOf(Mehrdadtest)).call(this,container,tree,options))}_createClass(Mehrdadtest,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(){return NodeShape}},{key:"__setupOptions",value:function __setupOptions(options){var This=this;options.add(new Options.Button("center").onClick(function(){This.synchronizeNode("focused",This.getTree().getRoot())}))}}]);return Mehrdadtest}(VIZ2D.Visualisation);Mehrdadtest.description={name:"mehrdad test lab",description:"mehrdadtest is a laboratory for mehrdad to do tests",image:""};VisualisationHandler.registerVisualisation(Mehrdadtest)})();;(function(){var Test=function(_Visualisation2d){_inherits(Test,_Visualisation2d);function Test(container,tree,options){_classCallCheck(this,Test);var _this11=_possibleConstructorReturn(this,(Test.__proto__||Object.getPrototypeOf(Test)).call(this,container,tree,options));_this11.mouseSelected=null;return _this11}_createClass(Test,[{key:"__onUpdate",value:function __onUpdate(deltaTime){_get(Test.prototype.__proto__||Object.getPrototypeOf(Test.prototype),"__onUpdate",this).call(this,deltaTime);var range=30;var camera=this.getCamera();var scale=camera.getScale();var mouseLoc=this.getMouseLoc();var nodeShapes=this.search(mouseLoc,range/scale);var closest={shape:null,dist:Infinity};for(var i=0;i<nodeShapes.length;i++){var nodeShape=nodeShapes[i];var dist=nodeShape.targetLoc.getVecTo(mouseLoc).getLength();if(dist<closest.dist&&dist<=range/scale)closest={shape:nodeShape,dist:dist}}if(this.mouseSelected!=closest.shape){if(this.mouseSelected)this.mouseSelected.setTargetLoc(this.mouseSelected.targetLoc,0.6,10,function(){this.__deregisterUpdateListener()}).__registerUpdateListener();this.mouseSelected=closest.shape;if(this.mouseSelected)this.mouseSelected.setTargetLoc(function(){return this.getGraphics().getMouseLoc()},0.6,10).__registerUpdateListener()}}},{key:"__getNodeShapeClass",value:function __getNodeShapeClass(VIZ){var camera=this.getCamera();var gfx=this;var initWidth=400;return function(_VIZ$NodeShape){_inherits(NodeShape,_VIZ$NodeShape);function NodeShape(gfx,node,scale){_classCallCheck(this,NodeShape);var _this12=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale||1;this.line=new VIZ.Line(gfx,new VIZ.XYZ(0,0),new VIZ.XYZ(0,0),10,16777215).setZ(-1)}));_this12.setScale(_this12.scale);_this12.addShape(_this12.line);var This=_this12;_this12.getLoc().onChange(function(){if(!This.getParent())This.line.setEndPoint(This.getLoc())});_this12.circle=new VIZ.Circle(gfx,30,16711680);_this12.addShape(_this12.circle);_this12.circle.onHover(function(over){if(over)This.highlight();else This.dehighlight()});_this12.setAngle(Math.random()-0.1);_this12.onClick(function(){this.focus()});_this12.onMousePress(function(type,data){var button=data.data.button;if(button==1){this.createParent();var p=this.getParent();if(p)p.focus();return true}});_this12.text=new VIZ.HtmlShape(gfx,node.getName());_this12.text.setScale(2);_this12.onHover(function(over){if(over)this.addShape(this.text);else{this.removeShape(this.text)}});_this12.storeInSpatialTree=true;_this12.__updateAABB();_this12.__stateChanged();return _this12}_createClass(NodeShape,[{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){camera.setTarget(this.targetLoc,this,this);this.createDescendants(2);this.destroyDescendants(2);this.createAncestors(2);this.destroyAncestors(2,true)}if(this.circle)this.circle.setColor(this.state.highlighted?16711935:this.state.expanded?255:16711680)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var w=(-parent.scale/2+(this.getIndex()+0.5)*this.scale)*initWidth;this.targetLoc=new VIZ.XYZ(parent.targetLoc).add(w,-130*parent.scale,this.getZ());var This=this;parent.getLoc().onChange(function(){This.line.getEndPoint().set(this)}).__fireEvent()}else{this.targetLoc=new VIZ.XYZ}}},{key:"__show",value:function __show(){var connectedNode=this.getConnectedNodeShape();if(connectedNode){this.getLoc().set(connectedNode.getLoc()).sub(0,0,(connectedNode==this.getParent()?1:-1)*1e-4);this.setScale(connectedNode.getScale())}else{this.setLoc(this.targetLoc);this.setScale(0)}var c=2;var complete=function complete(){if(--c==0)this.__deregisterUpdateListener()};this.setTargetLoc(this.targetLoc,0.6,10,complete).setTargetScale(this.scale,0.6,7,complete).__registerUpdateListener()}},{key:"__hide",value:function __hide(){var target=this.getLoc();var targetScale=0;var connectedShape=this.getConnectedNodeShape(true);if(connectedShape){target=connectedShape.getLoc();targetScale=function targetScale(){return connectedShape.getScale()}}var c=2;var complete=function complete(){if(--c==0)this.__deregisterUpdateListener().__delete()};this.setTargetLoc(target,0,12,complete).setTargetScale(targetScale,0,8,complete).__registerUpdateListener()}},{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var scale=parent.scale/parent.getNode().getChildren().length;return new(this.__getClass())(this.getGraphics(),node,scale)}}]);return NodeShape}(VIZ.NodeShape)}}]);return Test}(Visualisation2d);Test.description={name:"test",description:"Some test visualisation",image:""};VisualisationHandler.registerVisualisation(Test)})();(function(){var radius=0.1;var length=0.3;var NodeShape=function(_VIZ3D$NodeShape2){_inherits(NodeShape,_VIZ3D$NodeShape2);function NodeShape(gfx,node,scale,isBranch){_classCallCheck(this,NodeShape);if(!scale)scale=1;var _this13=_possibleConstructorReturn(this,(NodeShape.__proto__||Object.getPrototypeOf(NodeShape)).call(this,gfx,node,function(){this.scale=scale;this.isBranch=isBranch;this.leafColor=new VIZ3D.Color(0,255,0).setValue(0.3+node.getDepth()/gfx.getTree().getHeight()*0.7).getInt();this.sphere=new VIZ3D.Sphere(gfx,radius,this.leafColor);this.branch=new VIZ3D.Line(gfx,null,null,0.03,13789470);this.label=new VIZ3D.HtmlShape(gfx,node.getName());this.branch.storeInSpatialTree=true}));_this13.setScale(_this13.scale);_this13.addShape(_this13.sphere);_this13.addShape(_this13.branch);_this13.onClick(function(data){if(this.graphics.dragging<10)this.focus()});var This=_this13;_this13.sphere.onHover(function(over){if(over)This.highlight();else This.dehighlight()});_this13.__registerUpdateListener();_this13.storeInSpatialTree=true;_this13.__updateAABB();return _this13}_createClass(NodeShape,[{key:"getRadius",value:function getRadius(){return this.scale*radius}},{key:"__onUpdate",value:function __onUpdate(time){if(!this.state.dragged){var shapes=this.search(this.getScale()*0.1);var force=new VIZ3D.Vec;var vec=new VIZ3D.Vec;for(var i=0;i<shapes.length;i++){var shape=shapes[i];if(shape instanceof VIZ3D.Line){}else if(shape instanceof NodeShape){var dist=radius*(this.getScale()+shape.getScale());vec.set(this.getLoc()).sub(shape.getLoc());if(vec.getLength()<dist){force.add(vec.mul(0.1))}}}vec.set(this.homeLoc).sub(this.getLoc());force.add(vec.mul(0.2));this.getVelo().add(force.mul(0.1));_get(NodeShape.prototype.__proto__||Object.getPrototypeOf(NodeShape.prototype),"__onUpdate",this).call(this,time)}}},{key:"__createChildNodeShape",value:function __createChildNodeShape(node,parent){var parentDescCount=node.getParent()&&node.getParent().getSubtreeNodeCount()||node.getSubtreeNodeCount();var descPer=node.getSubtreeNodeCount()/parentDescCount;var scale=parent.scale/1.6/(1-Math.log(descPer)/Math.log(30));var children=this.getNode().getChildren();var firstChild=children[children.length-1]==node;return new(this.__getClass())(this.getGraphics(),node,scale,firstChild&&this.isBranch)}},{key:"__connectParent",value:function __connectParent(parent){if(parent){var nodeCount=parent.getNode().getChildren().length;this.setLoc(parent.getLoc());var f=this.scale;var vec=new VIZ3D.Vec().setLength(length*f*Math.sqrt(1+nodeCount/40));vec.setYaw(Math.PI*2*(this.getIndex()+0.5)/nodeCount+parent.getRot().getY()).setPitch(0.3).add(0,length*0.2*f*Math.sqrt(nodeCount/60),0);vec.setLength(vec.getLength()*(1+1*this.getIndex()/nodeCount));if(nodeCount==1)vec.setX(0).setZ(0);vec.addLength(parent.getRadius());this.getLoc().add(vec);this.getRot().set(vec.getRot());this.homeLoc=new VIZ3D.XYZ(this.getLoc());this.branch.setEndPoint(parent.getWorldLoc());var This=this;parent.getLoc().onChange(function(){This.branch.setEndPoint(parent.getWorldLoc())})}else{this.branch.setEndPoint(new VIZ3D.XYZ(0,-length,0));this.homeLoc=new VIZ3D.XYZ(this.getLoc())}}},{key:"__stateChanged",value:function __stateChanged(field,val,oldState){if(field=="focused"&&val==true){this.getGraphics().getCamera().setTargetLoc(this).setTargetScale(this);this.showFamily(Infinity,4)}this.sphere.setColor(this.state.highlighted?8978312:this.state.expanded?this.leafColor:5635925);if(field=="highlighted"){if(val==true)this.addShape(this.label);else this.removeShape(this.label)}}}]);return NodeShape}(VIZ3D.NodeShape);var Tree=function(_VIZ3D$Visualisation2){_inherits(Tree,_VIZ3D$Visualisation2);function Tree(container,tree,options){_classCallCheck(this,Tree);window.debugging=true;var _this14=_possibleConstructorReturn(this,(Tree.__proto__||Object.getPrototypeOf(Tree)).call(this,container,tree,options));_this14.random=Math.seed(10);var camera=_this14.getCamera();camera.setXRot(-0.5).setYRot(0.5*Math.PI);camera.setDistance(0.5);var This=_this14;This.dragging=false;_this14.onMousePress(function(down){This.dragging=down?1:false});This.oldMousePos={x:0,y:0};_this14.onMouseMove(function(pos){if(This.dragging){This.dragging++;var dx=pos.x-This.oldMousePos.x;var dy=pos.y-This.oldMousePos.y;camera.getRot().add(-dy/100,-dx/100,0)}This.oldMousePos.x=pos.x;This.oldMousePos.y=pos.y});var distObj=$({dist:camera.getDistance()});var targetDist=camera.getDistance();_this14.onMouseScroll(function(scroll){targetDist-=scroll/1000;targetDist=Math.max(targetDist,0.2);distObj.stop(true).animate({dist:targetDist},{easing:"linear",duration:200,step:function step(val){camera.setDistance(val)}})});_this14.maxNodeCount=200;var light=new VIZ3D.PointLight(_this14,16777215).setLoc(0.7,0.4,0).add();_this14.getShapesRoot()[0].focus();window.vis=_this14;return _this14}_createClass(Tree,[{key:"__getNodeShapeClass",value:function __getNodeShapeClass(){return NodeShape}},{key:"__setupOptions",value:function __setupOptions(options){var This=this;options.add(new Options.Button("center").onClick(function(){This.synchronizeNode("focused",This.getTree().getRoot())}));options.add(new Options.Number("rotation",0.5))}},{key:"__setupRoot",value:function __setupRoot(){var node=this.tree.getRoot();var clas=this.__getNodeShapeClass(Visualisation2d.classes,node);var shape=new clas(this,node,1,true);return shape.add()}}]);return Tree}(VIZ3D.Visualisation);Math.seed=function(s){return function(){s=Math.sin(s)*10000;return s-Math.floor(s)}};Tree.description={name:"tree",description:"3D version of carreer tree",image:""};VisualisationHandler.registerVisualisation(Tree)})();})();