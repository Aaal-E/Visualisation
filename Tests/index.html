<htmL>
    <head>
        <!--libraries-->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="../Libraries/pixi.min.js"></script>
        <script src="../Libraries/stats.js"></script>
        <script src="../Libraries/RBush-3d.js"></script>
        
        <!--graphics interface-->
        <script src="../Classes/Graphics/Utils/Loc.js"></script>
        <script src="../Classes/Graphics/Utils/Vec.js"></script>
        
        <script src="../Classes/Graphics/AbstractCamera.js"></script>
        <script src="../Classes/Graphics/AbstractGraphics.js"></script>
        <script src="../Classes/Graphics/AbstractShape.js"></script>
        
        <!--2d graphics api-->
        <script src="../Classes/Graphics/2d/Camera.js"></script>
        <script src="../Classes/Graphics/2d/Graphics.js"></script>
        <script src="../Classes/Graphics/2d/Shape.js"></script>
        <script src="../Classes/Graphics/2d/Shapes/Rectangle.js"></script>
        <script src="../Classes/Graphics/2d/Shapes/Circle.js"></script>
        <script src="../Classes/Graphics/2d/Shapes/CompoundShape.js"></script>
        <script src="../Classes/Graphics/2d/IO2d.js"></script>
    </head>
    <body>
        
    </body>
    <script>
        var stats = new Stats();
        stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
        document.body.appendChild(stats.domElement)
        
        var keys = Object.keys(IO2d);
        for(var i=0; i<keys.length; i++){
            var key = keys[i];
            window[key] = IO2d[key];
        }
    
        function randomColor(){
            return (Math.floor(Math.random()*0x100)<<16)+
                    (Math.floor(Math.random()*0x100)<<8)+
                    Math.floor(Math.random()*0x100);
        }
    
        var graphics = new Graphics();
        var camera = graphics.camera();
        
        /*simple stress test*/
        //create shapes
        // for(var i=0; i<2000; i++){
        //     var rect = new Rectangle(10, 10, randomColor());
        //     graphics.add(rect);
        // }
        // for(var i=0; i<2000; i++){
        //     var circle = new Circle(5, randomColor());
        //     graphics.add(circle);
        // }
        
        //update shapes and fps counter
        // graphics.update(function(){
        //     stats.begin();
        //     var shapes = this.getShapes();
        //     for(var i=0; i<shapes.length; i++){
        //         var shape = shapes[i];
        //         shape.setX(shape.getX()+Math.random()*5-2.5).setY(shape.getY()+Math.random()*5-2.5).setZRot(shape.getZRot()+Math.random()*0.2-0.1);
        //     }
        //     stats.end();
        // });
        
        /*compound shape test*/
        // var shape = new CompoundShape();
        // var rect = new Rectangle(300, 300, 0x00ff00);
        // var circle = new Circle(200, 0xff0000);
        // rect.setX(150).setY(150);
        // circle.setX(-200);
        // graphics.add(shape);
        // shape.addShapes(rect, circle);
        
        /*spatial tree test*/
        // var circle1 = new Circle(50, 0xff0000);
        // var circle2 = new Circle(50, 0x00ff00);
        // var circle3 = new Circle(50, 0x0000ff);
        // circle1.setLoc(60, 60, 0);
        // circle2.setLoc(-60, -60, 0);
        // circle3.setLoc(90, -90, 0);
        // graphics.add(circle1, circle2, circle3);
        
        
        var range = 600;
        var circles = [];
        
        for(var i=0; i<3; i++){
            var circle = new Circle(30, randomColor());
            circle.setLoc(Math.random()*600-300, Math.random()*600-300, 0);
            graphics.add(circle);
            circles.push(circle);
        }
        
        
        for(let i=0; i<circles.length; i++){
            var circle = circles[i];
            
            circle.vec = new Vec(0, 0, 0);
            circle.update(function(delta){
                var closeCircles = this.search(range);
                
                var force = new Vec(0, 0, 0);
                for(let j=0; j<closeCircles.length; j++){
                    var cc = closeCircles[j];
                    var dist = this.distance(cc);
                    var totRad = cc.radius()+this.radius();
                    
                    var forceStrength = totRad-dist;
                    
                    var vec = this.loc.getVec(cc.loc);
                    force.add(vec.length(forceStrength));
                }
                force.z(0);
                
                this.vec.add(force);
                this.loc.add(new Vec(force).mul(delta*0.05));
            });
        }
        
        graphics.update(function(){
            stats.begin();
            stats.end();
        });
    </script>
</htmL>